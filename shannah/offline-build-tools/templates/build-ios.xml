<project>
<!-- Update to point to the CodenameOne repository in your system -->
<property name="codename1.repo.path" location="___CODENAMEONE_PATH___"/>

<!-- Update to point to the proper location of xmlvm binary on your system -->
<property name="xmlvm.path" location="___XMLVM_PATH___"/>

<!-- Update to point to the proper location of the ANT binary on your system -->
<property name="ant.path" location="/usr/bin/ant"/>

<!-- Update to point to the proper location of python binary on your system -->
<property name="python.path" location="/usr/bin/python"/>

<!-- Update to point to the CodenameOneIOSProcessor jar file -->
<property name="iosbuildtools.path" location="___BUILDTOOLS_PATH___"/>
<loadproperties srcFile="${iosbuildtools.path}/codename1.properties"/>


<property name="configureMainStub.path" location="${iosbuildtools.path}/scripts/configure_main_stub.php"/>
<property name="processor.jar.path" location="${iosbuildtools.path}/dist/CodenameOneIOSProcessor.jar"/>
<property name="velocity.jar.path" location="${iosbuildtools.path}/lib/velocity-1.7.jar"/>
<property name="velocity.dep.jar.path" location="${iosbuildtools.path}/lib/velocity-1.7-dep.jar"/>
<property name="this.project.path" location="."/>

<!-- You should need to change anything below this line -->
<property name="distapp.path" location="./dist/app"/>
<property name="codename1.path" location="${codename1.repo.path}/CodenameOne"/>
<property name="codename1.factory.path" location="${codename1.repo.path}/Factory"/>
<property name="codename1.iosport.path" location="${codename1.repo.path}/Ports/iOSPort"/>
<property name="codename1.androidport.path" location="${codename1.repo.path}/Ports/Android"/>

<property name="buildscripts.path" location="${iosbuildtools.path}/scripts"/>
<property name="xcodeadd.path" location="${iosbuildtools.path}/scripts/xcodeadd.py"/>
<property name="resources.path" location="${distapp.path}/btres"/>
<property name="xcodeproj.path" location="${distapp.path}/dist/${codename1.displayName}.xcodeproj"/>

<!-- IOS Settings -->
<property name="ios.sdk.path" location="/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS6.0.sdk"/>


<!-- android settings -->
<property name="android.dist.path" location="./dist/android"/>
<property name="android.assets.path" location="${android.dist.path}/assets"/>
<property name="android.res.path" location="${android.dist.path}/res"/>
<property name="android.manifest.path" location="${android.dist.path}/AndroidManifest.xml"/>
<property name="android.src.path" location="${android.dist.path}/src"/>
<property name="android.bin.path" location="${android.dist.path}/bin"/>
<property name="android.obj.path" location="${android.dist.path}/obj"/>

<property name="android.sdk.path" location="/Volumes/Windows VMS/adt-bundle-mac-x86_64/sdk"/>
<property name="android.sdk.version" value="17"/>
<property name="dx.path" location="${android.sdk.path}/platform-tools/dx"/>
<property name="aapt.path" location="${android.sdk.path}/platform-tools/aapt"/>
<property name="adb.path" location="${android.sdk.path}/platform-tools/adb"/>
<property name="android.sdk.jar.path" location="${android.sdk.path}/platforms/android-${android.sdk.version}/android.jar"/>

<!-- JavaSE Settings -->
<property name="codename1.javaseport.path" location="${codename1.repo.path}/Ports/JavaSE"/>
<property name="javase.dist.path" location="./dist/JavaSE"/>
<property name="javase.build.path" location="${javase.dist.path}/build"/>
<property name="javase.src.path" location="${javase.dist.path}/src"/>
<property name="jdk.path" location="/Library/Java/JavaVirtualMachines/jdk1.7.0_10.jdk/Contents/Home"/>



<target name="build-for-JavaSE-locally" depends="build-skins">
	<delete dir="${javase.dist.path}"/>
	<mkdir dir="${javase.src.path}"/>
	<mkdir dir="${javase.build.path}"/>
	
	<copy todir="${javase.src.path}">
		<fileset dir="${codename1.path}/src" excludes="**/svn/"/>
		<fileset dir="${codename1.javaseport.path}/src" excludes="**/svn/"/>
		<fileset dir="src" excludes="**/svn/"/>
		<fileset dir="${codename1.repo.path}/Skins" includes="**/*.skin"/>
		
	</copy>
	<copy todir="${javase.src.path}" file="${iosbuildtools.path}/templates/JavaSEStub.java"/>
	<replace file="${javase.src.path}/JavaSEStub.java"
            token="#MAIN_CLASS#"
            value="${codename1.packageName}.${codename1.mainName}"/>
               
	<javac srcdir="${javase.src.path}"
   		  destdir="${javase.build.path}"
   		  classpath="${jdk.path}/jre/lib/jfxrt.jar:${jdk.path}/jre/lib/javaws.jar"

   		  debug="on"/>
   	<copy todir="${javase.build.path}">
   		<fileset dir="${javase.src.path}" excludes="**/*.java"/>
   	</copy>
   	<unjar src="${codename1.javaseport.path}/lib/sqlitejdbc-v056.jar" dest="${javase.build.path}"/>
   	<jar destfile="${javase.dist.path}/${codename1.displayName}.jar">
   		<fileset dir="${javase.build.path}" includes="**/*"/>
   		<manifest>
   			<attribute name="Main-Class" value="JavaSEStub"/>
   		</manifest>
   	</jar>
   	
   	<exec executable="java">
   		<arg value="-jar"/>
   		<arg file="${javase.dist.path}/${codename1.displayName}.jar"/>
   	</exec>
   	
	
</target>

<target name="build-skins">
        <copy file="${codename1.repo.path}/Themes/androidTheme.res" todir="${codename1.repo.path}/Skins/android" />
        <copy file="${codename1.repo.path}/Themes/androidTheme.res" todir="${codename1.repo.path}/Skins/nexus" />
        <copy file="${codename1.repo.path}/Themes/iPhoneTheme.res" todir="${codename1.repo.path}/Skins/ipad" />
        <copy file="${codename1.repo.path}/Themes/iPhoneTheme.res" todir="${codename1.repo.path}/Skins/iphone4" />
        <copy file="${codename1.repo.path}/Themes/iPhoneTheme.res" todir="${codename1.repo.path}/Skins/ipad3" />
        <copy file="${codename1.repo.path}/Themes/iPhoneTheme.res" todir="${codename1.repo.path}/Skins/iphone3gs" />
        <copy file="${codename1.repo.path}/Themes/iPhoneTheme.res" todir="${codename1.repo.path}/Skins/iphone5" />
        <copy file="${codename1.repo.path}/Themes/blackberry_theme.res" todir="${codename1.repo.path}/Skins/torch" />
        <copy file="${codename1.repo.path}/Themes/android_holo_light.res" todir="${codename1.repo.path}/Skins/xoom" />
        <copy file="${codename1.repo.path}/Themes/winTheme.res" todir="${codename1.repo.path}/Skins/lumia" />

        
        <zip basedir="${codename1.repo.path}/Skins/nexus" destfile="${codename1.repo.path}/Skins/nexus.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/torch" destfile="${codename1.repo.path}/Skins/torch.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/android" destfile="${codename1.repo.path}/Skins/android.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/feature_phone" destfile="${codename1.repo.path}/Skins/feature_phone.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/ipad" destfile="${codename1.repo.path}/Skins/ipad.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/ipad3" destfile="${codename1.repo.path}/Skins/ipad3.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/iphone3gs" destfile="${codename1.repo.path}/Skins/iphone3gs.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/iphone4" destfile="${codename1.repo.path}/Skins/iphone4.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/iphone5" destfile="${codename1.repo.path}/Skins/iphone5.skin" compress="false">
            <exclude name="**/svn/"/>
            <exclude name="*.psd"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/xoom" destfile="${codename1.repo.path}/Skins/xoom.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
        <zip basedir="${codename1.repo.path}/Skins/lumia" destfile="${codename1.repo.path}/Skins/lumia.skin" compress="false">
            <exclude name="**/svn/"/>
        </zip>
    </target>   


<target name="build-for-android-device-locally" depends="">
	<delete dir="${android.dist.path}"/>
	<mkdir dir="${android.assets.path}"/>
	<mkdir dir="${android.res.path}"/>
	<mkdir dir="${android.src.path}"/>
	<mkdir dir="${android.bin.path}"/>
	<mkdir dir="${android.obj.path}"/>
	<copy todir="${android.src.path}">
		<fileset dir="${codename1.path}/src" includes="**/*.java"/>
	   <fileset dir="${codename1.androidport.path}/src" includes="**/*.java"/>
	   <fileset dir="native/android" includes="**/*.java"/>
	   <fileset dir="src" includes="**/*.java"/>
   	</copy>
   	<copy todir="${android.assets.path}">
   		<fileset dir="${codename1.androidport.path}/src" includes="**/*.res,**/*.html,**/*.png,**/*.jpg,**/*.gif"/>
   		<fileset dir="native/android" includes="**/*.res,**/*.html,**/*.png,**/*.jpg,**/*.gif"/>
	   <fileset dir="src" includes="**/*.res,**/*.html,**/*.png,**/*.jpg,**/*.gif"/>
   	</copy>
   	<copy file="${iosbuildtools.path}/templates/AndroidStub.java"
        tofile="${android.src.path}/com/codename1/impl/android/AndroidStub.java" />
   <copy file="${iosbuildtools.path}/templates/AndroidManifest.xml"
        tofile="${android.dist.path}/AndroidManifest.xml"/>
   
    <replace file="${android.src.path}/com/codename1/impl/android/AndroidStub.java"
            token="#MAIN_CLASS#"
            value="${codename1.packageName}.${codename1.mainName}"/>    
   	<replace file="${android.dist.path}/AndroidManifest.xml"
            token="#PACKAGE_NAME#"
            value="${codename1.packageName}"/> 
    <replace file="${android.dist.path}/AndroidManifest.xml"
            token="#APPLICATION_NAME#"
            value="${codename1.displayName}"/>    
   	
   	<javac srcdir="${android.src.path}"
   		  destdir="${android.obj.path}"
   		  classpath="${android.sdk.path}/platforms/android-${android.sdk.version}/android.jar:${android.obj.path}:${codename1.androidport.path}/lib/zooz_iap.jar"
   		  source="1.6"
   		  target="1.6"
   		  debug="on"/>
   		  
   		  
   	<exec executable="${dx.path}">
   		<arg value="--dex"/>
   		<arg value="--verbose"/>
   		<arg line="--output='${android.bin.path}/classes.dex'"/>
   		<arg file="${android.obj.path}"/>
   	</exec>  
   	<exec executable="${aapt.path}">
   		<arg value="package"/>
   		<arg value="-v"/>
   		<arg value="-f"/>
   		<arg value="-M"/>
   		<arg file="${android.manifest.path}"/>
   		<arg value="-A"/>
   		<arg file="${android.assets.path}"/>
   		<arg value="-I"/>
   		<arg file="${android.sdk.jar.path}"/>
   		<arg value="-F"/>
   		<arg file="${android.bin.path}/${codename1.displayName}.unsigned.apk"/>
   		<arg file="${android.bin.path}"/>
   	</exec>
   	<!--
   	<signjar jar="${android.bin.path}/${codename1.displayName}.unsigned.apk"
   		signedjar="${android.bin.path}/${codename1.displayName}.signed.apk"
   		keystore="${codename1.android.keystore}"
   		storepass="${codename1.android.keystorePassword}"
   		keypass="${codename1.android.keystorePassword}"
   		alias="${codename1.android.keystoreAlias}"
   		verbose="true"/>
   	-->
   		
   	<exec executable="jarsigner">
   		<arg value="-verbose"/>
   		<arg value="-digestalg"/>
   		<arg value="SHA1"/>
   		<arg value="-sigalg"/>
   		<arg value="MD5withRSA"/>
   		<arg value="-keystore"/>
   		<arg file="${codename1.android.keystore}"/>
   		<arg value="-storepass"/>
   		<arg value="${codename1.android.keystorePassword}"/>
   		<arg value="-keypass"/>
   		<arg value="${codename1.android.keystorePassword}"/>
   		<arg value="-signedjar"/>
   		<arg file="${android.bin.path}/${codename1.displayName}.signed.apk"/>
   		<arg file="${android.bin.path}/${codename1.displayName}.unsigned.apk"/>
   		<arg value="${codename1.android.keystoreAlias}"/>
   	</exec>
   		
   	<exec executable="${adb.path}">
   		<arg value="-d"/>
   		<arg value="install"/>
   		<arg value="-r"/>
   		<arg file="${android.bin.path}/${codename1.displayName}.signed.apk"/>
   	</exec>

</target>

<target name="build-for-ios-device-locally" depends="">
        
        
        <delete dir="${distapp.path}"/>
        <exec executable="${xmlvm.path}">
            <arg value="--skeleton=iphone"/>
            <arg value="--out=${distapp.path}"/>
            <arg value="--app-name=${codename1.displayName}"/>
            <arg value="-DBundleIdentifier=${codename1.ios.appid}"/>
            <arg value="-DBundleVersion=${codename1.version}"/>
            <arg value="-DBundleDisplayName=${codename1.displayName}"/>
            <arg value="--lib=${codename1.iosport.path}/nativeSources/libzbar.a"/>
        </exec>
        
        <replace file="${distapp.path}/xmlvm.properties" token="xmlvm.backend=objc"
            value="xmlvm.backend=c"/>
        <replaceregexp file="${distapp.path}/xmlvm.properties" match="bundle\.identifier=.*"
            replace="bundle.identifier=${codename1.ios.appid}"/>
        <replaceregexp file="${distapp.path}/xmlvm.properties" match="bundle\.version=.*"
            replace="bundle.identifier=${codename1.version}"/>
       
       <copy todir="${distapp.path}/src/java">
           
            <fileset dir="${codename1.path}/src"/>
            <fileset dir="${codename1.factory.path}/src"/>
            <fileset dir="${codename1.iosport.path}/src"/>
            <fileset dir="src"/>
       </copy>
       <mkdir dir="${distapp.path}/src/tmpbuild"/>
       <delete dir="${distapp.path}/src/java/my"/>
       <javac fork="yes"
            srcdir="${distapp.path}/src/java"
            destdir="${distapp.path}/src/tmpbuild"
            includes="**/*.java"
            classpath="${javac.classpath}:${build.classes.dir}:${dist.jar}:${processor.jar.path}:${velocity.jar.path}:${velocity.dep.jar.path}:${distapp.path}/src/java"
            >
           <compilerarg line="-processor ca.weblite.codename1.build.ios.NativeAnnotationProcessor"/>
           <compilerarg value="-s"/>
            <compilerarg path="${distapp.path}/src/java"/>
       </javac>
       <mkdir dir="${resources.path}"/>
       <copy todir="${resources.path}">
           <fileset dir="${codename1.iosport.path}/nativeSources" includes="**/*.a,**/*.res,**/*.html,**/*.png,**/*.jpg,**/*.gif"/>
           <fileset dir="src" includes="**/*.a,**/*.res,**/*.html,**/*.png,**/*.jpg,**/*.gif"/>
       </copy>
       
            
       
       <mkdir dir="${distapp.path}/src/objc"/>
       <copy todir="${distapp.path}/src/objc">
           <fileset dir="${codename1.iosport.path}/nativeSources"/>
           <fileset dir="native/ios" includes="*.m,*.h"/>
           <fileset dir="${distapp.path}/src/java/" includes="*.h,*.m"/>
       </copy>
       <zip zipfile="${distapp.path}/nativeios.jar" basedir="${distapp.path}/src/" includes="objc/**"/>
       <replace file="${distapp.path}/nbproject/project.properties"
            token="run.classpath="
            value="run.classpath=nativeios.jar:"/>
       <replace file="${distapp.path}/nbproject/build-Xcode.xml"
            token="-Xmx512m"
            value="-Xmx2G" />
       
       <copy file="${iosbuildtools.path}/templates/MainStub.java"
            
             tofile="${distapp.path}/src/java/com/codename1/impl/ios/Main.java" />
       
       <exec executable="/usr/bin/php">
           <arg path="${configureMainStub.path}"/>
           <arg path="${this.project.path}"/>
           <arg path="${distapp.path}/src/java/com/codename1/impl/ios/Main.java"/>
       </exec>
       
       <replace file="${distapp.path}/src/java/com/codename1/impl/ios/Main.java"
            token="#MAIN_CLASS#"
            value="${codename1.packageName}.${codename1.mainName}"/>
       <delete dir="${distapp.path}/src/java/my"/>
       <exec executable="${ant.path}" dir="${distapp.path}/"/>
       <apply executable="${python.path}" dir="${buildscripts.path}">
           <arg file="${xcodeadd.path}"/>
           <arg file="${xcodeproj.path}/project.pbxproj"/>
           <fileset dir="${resources.path}"/>
       </apply>
       
       <exec executable="${python.path}" dir="${buildscripts.path}">
       		<arg file="${xcodeadd.path}"/>
       		<arg file="${xcodeproj.path}/project.pbxproj"/>
       		<arg file="${ios.sdk.path}/usr/lib/libxml2.2.dylib"/>
       </exec>
       <exec executable="${python.path}" dir="${buildscripts.path}">
       		<arg file="${xcodeadd.path}"/>
       		<arg file="${xcodeproj.path}/project.pbxproj"/>
       		<arg file="${ios.sdk.path}/System/Library/Frameworks/Security.framework"/>
       </exec>
       <exec executable="open">
       		<arg file="${xcodeproj.path}"/>
       </exec>
      
       
    </target>
</project>